FROM node:24-alpine

WORKDIR /app

# Prepare workspace layout for caching installs
RUN mkdir -p apps/api apps/web packages

# Install dependencies
COPY package.json package-lock.json turbo.json ./
COPY apps/api/package.json apps/api/package.json
COPY apps/web/package.json apps/web/package.json
RUN npm install

# Copy full repo
COPY . .

WORKDIR /app/apps/api

EXPOSE 4000

# Use direct node command instead of npm run dev to avoid --env-file dependency
# Docker Compose env_file handles environment variables
CMD ["node", "--experimental-transform-types", "--watch", "src/index.ts"]
